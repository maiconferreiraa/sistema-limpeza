{% extends "layout.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0 text-primary-emphasis"><i class="bi bi-calculator-fill"></i> Gerar Novo Orçamento</h1>
</div>

<div class="card shadow border-secondary bg-dark text-light">
    <div class="card-body p-4">
        <form action="{{ url_for('gerar_orcamento_pdf') }}" method="POST">
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <label class="form-label small text-secondary fw-bold">CLIENTE</label>
                    <select name="cliente_id" id="cliente_select" class="form-select bg-dark text-white border-secondary" required>
                        <option value="">Selecione o cliente...</option>
                        {% for c in clientes %}
                        <option value="{{ c.id }}">{{ c.to_dict().nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label small text-secondary fw-bold">VALIDADE (DIAS)</label>
                    <input type="number" name="validade" class="form-control bg-dark text-white border-secondary" value="7">
                </div>
                <div class="col-md-3">
                    <label class="form-label small text-secondary fw-bold">FORMA DE PAGAMENTO</label>
                    <input type="text" name="forma_pagamento" class="form-control bg-dark text-white border-secondary" placeholder="Ex: PIX, Cartão..." value="Dinheiro ou PIX">
                </div>
            </div>

            <h5 class="border-bottom border-secondary pb-2 mb-3"><i class="bi bi-list-check"></i> Serviços Inclusos</h5>
            <div id="container-servicos">
                <div class="row g-2 mb-3 servico-item animate__animated animate__fadeIn">
                    <div class="col-md-7">
                        <select name="servicos[]" class="form-select bg-dark text-white border-secondary" required>
                            <option value="">Selecione o serviço...</option>
                            {% for s in servicos %}
                            <option value="{{ s.id }}">{{ s.to_dict().nome }} (R$ {{ "%.2f"|format(s.to_dict().preco_padrao) }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="number" name="quantidades[]" class="form-control bg-dark text-white border-secondary" placeholder="Qtd" value="1" min="1">
                    </div>
                    <div class="col-md-2 text-end">
                        <button type="button" class="btn btn-outline-danger" onclick="removerLinha(this)"><i class="bi bi-trash"></i></button>
                    </div>
                </div>
            </div>

            <button type="button" class="btn btn-sm btn-outline-info mb-4" onclick="adicionarLinha()">
                <i class="bi bi-plus-lg"></i> Adicionar outro serviço
            </button>

            <div class="border-top border-secondary pt-4 mt-2">
                <button type="submit" class="btn btn-primary btn-lg w-100 fw-bold shadow">
                    <i class="bi bi-file-earmark-pdf-fill"></i> GERAR PDF DO ORÇAMENTO
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function adicionarLinha() {
    const container = document.getElementById('container-servicos');
    const novaLinha = container.firstElementChild.cloneNode(true);
    novaLinha.querySelector('select').value = "";
    novaLinha.querySelector('input').value = "1";
    container.appendChild(novaLinha);
}

function removerLinha(btn) {
    const container = document.getElementById('container-servicos');
    if (container.children.length > 1) {
        btn.closest('.servico-item').remove();
    }
}
</script>
{% endblock %}