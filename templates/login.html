<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sistema de Limpeza</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    
    <style>
        body { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            background-color: #212529; /* Fundo escuro */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .form-signin { 
            max-width: 450px; /* AUMENTADO: Deixou a tela mais larga */
            width: 100%; 
            padding: 15px; 
        }
        .brand-title {
            color: #0d6efd; /* Azul Bootstrap */
            text-shadow: 0px 0px 10px rgba(13, 110, 253, 0.3);
        }
        .card {
            border: 1px solid #495057;
            background-color: #2b3035;
        }
    </style>
</head>
<body>

<main class="form-signin text-center">
    
    <div class="mb-4">
        <h1 class="h2 brand-title fw-bold">
            <i class="bi bi-shield-check"></i> Sistema de Limpeza
        </h1>
        <p class="text-secondary">Acesso Administrativo</p>
    </div>

    <div class="card shadow-lg">
        <div class="card-body p-5"> <h2 class="h4 mb-4 fw-normal text-white">Faça seu Login</h2>
            
            <div class="form-floating mb-3 text-start">
                <input type="email" class="form-control bg-dark text-white border-secondary" id="email" placeholder="nome@exemplo.com">
                <label for="email" class="text-secondary">Endereço de Email</label>
            </div>

            <div class="input-group mb-4">
                <div class="form-floating flex-grow-1 text-start">
                    <input type="password" class="form-control bg-dark text-white border-secondary" id="password" placeholder="Senha" style="border-right: none;">
                    <label for="password" class="text-secondary">Senha</label>
                </div>
                <button class="btn btn-outline-secondary border-start-0 bg-dark text-secondary" type="button" id="togglePassword">
                    <i class="bi bi-eye" id="eyeIcon"></i>
                </button>
            </div>

            <button class="w-100 btn btn-lg btn-primary mb-2 fw-bold" id="btnLogin">
                <i class="bi bi-box-arrow-in-right"></i> ENTRAR
            </button>
            
            <div id="error-msg" class="mt-3 text-danger fw-bold small"></div>
        </div>
    </div>
    
    <p class="mt-5 mb-3 text-muted">© 2025 Sistema de Limpeza Automotivo e Residencial</p>
</main>

<script>
    const togglePassword = document.querySelector('#togglePassword');
    const password = document.querySelector('#password');
    const eyeIcon = document.querySelector('#eyeIcon');

    togglePassword.addEventListener('click', function (e) {
        // Alternar o tipo de atributo
        const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
        password.setAttribute('type', type);
        
        // Alternar o ícone
        eyeIcon.classList.toggle('bi-eye');
        eyeIcon.classList.toggle('bi-eye-slash');
    });
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

  // --- IMPORTANTE: COLE SUAS CHAVES AQUI ---
  const firebaseConfig = {
    apiKey: "AIzaSyAzYgJGO6lvz7s9BMincNb-Qm9URkD8GCs",
    authDomain: "sistema-limpeza-e9e9e.firebaseapp.com",
    projectId: "sistema-limpeza-e9e9e",
    storageBucket: "sistema-limpeza-e9e9e.firebasestorage.app",
    messagingSenderId: "71391357517",
    appId: "1:71391357517:web:6d29a0c0237d895e548a04",
    measurementId: "G-N6VQPFQ2FZ"
    };
  // ----------------------------------------

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const errorMsg = document.getElementById('error-msg');
  const btnLogin = document.getElementById('btnLogin');

  // Função para enviar o token para o Python
  async function enviarTokenParaBackend(user) {
      const token = await user.getIdToken();
      
      const response = await fetch('/login/session', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ token: token })
      });

      if (response.ok) {
          window.location.href = '/'; 
      } else {
          errorMsg.textContent = "Erro de conexão com o servidor.";
          btnLogin.disabled = false;
          btnLogin.innerHTML = '<i class="bi bi-box-arrow-in-right"></i> ENTRAR';
      }
  }

  // Evento de Login
  btnLogin.addEventListener('click', () => {
      const email = emailInput.value;
      const pass = passwordInput.value;

      if(!email || !pass) {
          errorMsg.textContent = "Preencha email e senha.";
          return;
      }

      // Estado de carregamento
      btnLogin.disabled = true;
      btnLogin.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Entrando...';
      errorMsg.textContent = "";

      signInWithEmailAndPassword(auth, email, pass)
          .then((userCredential) => {
              enviarTokenParaBackend(userCredential.user);
          })
          .catch((error) => {
              console.error(error);
              btnLogin.disabled = false;
              btnLogin.innerHTML = '<i class="bi bi-box-arrow-in-right"></i> ENTRAR';
              
              // Mensagens de erro amigáveis em Português
              if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                  errorMsg.textContent = "Email ou senha incorretos.";
              } else if (error.code === 'auth/invalid-email') {
                  errorMsg.textContent = "Email inválido.";
              } else if (error.code === 'auth/too-many-requests') {
                  errorMsg.textContent = "Muitas tentativas. Tente mais tarde.";
              } else {
                  errorMsg.textContent = "Erro ao entrar: " + error.message;
              }
          });
  });
  
  // Permitir login com a tecla Enter
  passwordInput.addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
      event.preventDefault();
      btnLogin.click();
    }
  });
</script>
</body>
</html>